# This runbook will create a disabled user.
# An administrator must enable the user, for example by using the GNOME settings app.

- name: Create User
  hosts: localhost
  become: true
  vars_prompt:
    - name: user_name
      prompt: User name
      private: false
  vars_files:
    - vars/disk-vars.yml
  vars:
    backup_dir: /run/media/{{ user_name }}/{{ backup_disk_label }}
  tasks:
    - name: Create User
      ansible.builtin.user:
        name: "{{ user_name }}"
        # Add user to Docker group.
        # This allows user to run Docker commands without sudo.
        # Ref: https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user
        groups: docker
        append: true

    - name: Create Backup Directory
      ansible.builtin.file:
        name: "{{ backup_dir }}"
        state: directory
        owner: "{{ user_name }}"
        group: "{{ user_name }}"
        mode: u=rwx,g=,o=
